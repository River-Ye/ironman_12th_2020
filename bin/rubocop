#!/usr/bin/env ruby
class RubocopRunner
  COMPARE_TO_BRANCH = 'master'.freeze
  CURRENT_BRANCH = `git branch | cat`.split("\n")[1].strip
  def self.check_branch_validity
    if CURRENT_BRANCH.empty? || CURRENT_BRANCH == COMPARE_TO_BRANCH
      puts "current_branch is #{CURRENT_BRANCH}, No git found, or you are still on #{COMPARE_TO_BRANCH} branch."
      exit 0
    end
  end

  def self.check_non_committed_changes
    system("git ls-files -m | xargs ls -1 2>/dev/null | grep '\.rb$' | xargs bundle exec rubocop #{ARGV.join(' ')}")
  end

  def self.check_committed_changes
    master_commit = `cat .git/FETCH_HEAD`.split[0]
    system("git diff -r --no-commit-id --name-only #{master_commit}..HEAD | xargs rubocop")
  end
end

RubocopRunner.check_branch_validity
RubocopRunner.check_non_committed_changes
RubocopRunner.check_committed_changes
